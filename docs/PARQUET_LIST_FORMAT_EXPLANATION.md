# Объяснение различий в формате списков Parquet: `list<element: >` vs `list<item: >`

## Проблема

При преобразовании одной и той же таблицы BigQuery в `.parquet` с использованием `pyarrow.parquet`, колонка типа `RECORD` (особенно с режимом `REPEATED`) может преобразовываться в:
- `list<element: struct<...>>` (старый формат)
- `list<item: struct<...>>` (новый формат)

## Причина

Различие возникает из-за параметра `use_compliant_nested_type` в PyArrow ParquetWriter:

1. **`use_compliant_nested_type=False`** (по умолчанию) → использует старый формат Parquet с именем `"element"` для элементов списка
2. **`use_compliant_nested_type=True`** → использует новый формат с именем `"item"`

### Дополнительные факторы:

- **Версия PyArrow**: Разные версии могут иметь разные значения по умолчанию
- **Источник данных**: 
  - Когда данные приходят напрямую из BigQuery через `result.to_arrow()`, BigQuery Storage API может использовать один формат
  - Когда схема создается вручную через `get_pyarrow_schema_from_bq()` и применяется через `table.cast()`, может использоваться другой формат
- **Отсутствие явного указания параметра**: Если параметр не указан явно, поведение может быть непредсказуемым

## Решение

В коде добавлен параметр `use_compliant_nested_type` в методы:
- `export_to_parquet()`
- `export_to_parquet_gzip()`

### Использование:

```python
# Для использования старого формата с "element" (по умолчанию)
parquet_path = exporter.export_to_parquet(
    query, 
    schema=pa_schema, 
    use_compliant_nested_type=False  # Использует "element"
)

# Для использования нового формата с "item"
parquet_path = exporter.export_to_parquet(
    query, 
    schema=pa_schema, 
    use_compliant_nested_type=True  # Использует "item"
)
```

## Рекомендации

1. **Явно указывайте `use_compliant_nested_type`** во всех вызовах для обеспечения консистентности
2. **Используйте одинаковое значение** во всех экспортах одной и той же таблицы
3. **Документируйте выбор формата** в вашем проекте

## Важно

Различие в именах (`element` vs `item`) **не влияет на данные**, но может повлиять на:
- Совместимость с другими инструментами, которые ожидают определенный формат
- Последующий импорт/анализ данных
- Консистентность схемы между разными экспортами

